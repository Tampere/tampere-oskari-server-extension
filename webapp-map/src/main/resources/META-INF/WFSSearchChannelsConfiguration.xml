<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="WFSSearchChannelsConfiguration">

    <typeAlias alias="WFSSearchChannelsConfiguration" type="tampere.domain.WFSSearchChannelsConfiguration" />
    
    <resultMap class="WFSSearchChannelsConfiguration" id="WFSSearchChannelsConfiguration">
        <result property="id" column="id"/>
        <result property="WFSLayerId" column="wfs_layer_id"/>
        <result property="topic" column="topic" jdbcType="VARCHAR" javaType="org.json.JSONObject"/>
        <result property="desc" column="desc" jdbcType="VARCHAR" javaType="org.json.JSONObject"/>
        <result property="paramsForSearch" column="params_for_search" jdbcType="VARCHAR" javaType="org.json.JSONArray"/>
    </resultMap>

    <parameterMap id="ChannelInsertParameter" class="WFSSearchChannelsConfiguration">
       <parameter property="WFSLayerId" />
       <parameter property="topic" />
       <parameter property="desc" />
       <parameter property="paramsForSearch" />
    </parameterMap>

    
    <parameterMap id="ChannelUpdateParameter" class="WFSSearchChannelsConfiguration">
        <parameter property="topic" />
        <parameter property="desc" />
        <parameter property="paramsForSearch" />
        <parameter property="id"/>
    </parameterMap>

    <cacheModel type="LRU" id="wfs-layer-cache" readOnly="true" serialize="false">
        <flushInterval minutes="15"/>
        <property name="CacheSize" value="100"/>
    </cacheModel>

    <select id="maxId" resultClass="int">
        SELECT max(id) FROM oskari_wfs_search_channels;
    </select>

    <statement id="findChannels" resultMap="WFSSearchChannelsConfiguration">
        SELECT
        *
        FROM oskari_wfs_search_channels
        ORDER BY id ASC;
    </statement>
    
    <statement id="delete" parameterClass="java.lang.Long">
        DELETE FROM oskari_wfs_search_channels WHERE id=#channel_id#;
    </statement>

    <statement id="insert" parameterMap="ChannelInsertParameter" >
        INSERT INTO oskari_wfs_search_channels (
        wfs_layer_id,
        topic,
        desc,
        params_for_search)
        values (?,?,?,?)
    </statement>

    <statement id="update" parameterMap="ChannelUpdateParameter">
        UPDATE portti_wfs_layer
        SET
        topic = ?,
        desc = ?,
        params_for_search
        WHERE id = ?
    </statement>
</sqlMap>